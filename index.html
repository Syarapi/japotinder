<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Japontinder</title>
<link href="https://fonts.googleapis.com/css2?family=Yuji+Syuku&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body {
    margin: 0;
    font-family: 'Segoe UI', sans-serif;
    background: #f0f0f0;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
  }
  h1, h2, h3 {
    font-family: 'Yuji Syuku', serif;
    text-align: center;
  }
  h1 { color: #dda0dd; }
  h2 { color: #87cefa; }
  h3 { color: #ffc0cb; }

  #start-screen, #results, #stats-screen {
    display: none;
    flex-direction: column;
    align-items: center;
    padding: 20px;
  }
  #start-screen {
    display: flex;
    justify-content: center;
    gap: 15px;
    height: 100vh;
  }
  #card-container {
    position: relative;
    width: 90%;
    max-width: 500px;
    height: 66vh;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .card {
    width: 100%;
    height: 100%;
    background: white;
    border-radius: 15px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: space-between;
    padding: 20px;
    box-sizing: border-box;
  }
  .card img {
    max-height: 85%;
    max-width: 100%;
    object-fit: cover;
    border-radius: 10px;
  }
  #buttons {
    margin-top: 20px;
    display: flex;
    gap: 20px;
    z-index: 10;
  }
  .btn {
    padding: 15px 25px;
    font-size: 18px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: background 0.3s ease, transform 0.2s ease;
  }
  .accept { background-color: #87cefa; color: white; }
  .reject { background-color: #ffc0cb; color: black; }
  .stats-btn { background-color: #dda0dd; color: white; }
  .accept:hover { background-color: #6fbde8; transform: scale(1.05); }
  .reject:hover { background-color: #ff9eb3; transform: scale(1.05); }
  .stats-btn:hover { background-color: #c58cc5; transform: scale(1.05); }

  .results-container {
    display: flex;
    gap: 50px;
    justify-content: center;
    flex-wrap: wrap;
  }
  .list { margin: 10px 0; }
  ul { list-style: none; padding: 0; font-size: 18px; }
  input {
    padding: 10px;
    font-size: 16px;
    border-radius: 5px;
    border: 1px solid #ccc;
    width: 200px;
    text-align: center;
  }
</style>
</head>
<body>

<!-- Pantalla de inicio -->
<div id="start-screen">
  <h1>Japontinder</h1>
  <p>¿Quién eres? O no empezamos ò_ó</p>
  <input type="text" id="username" placeholder="Tu nombre" />
  <button class="btn accept" onclick="startGame()">Empezar</button>
  <button class="btn stats-btn" onclick="showStats()">Ver estadísticas</button>
</div>

<!-- Juego -->
<div id="game-screen" style="display:none; flex-direction: column; align-items: center;">
  <div id="card-container"></div>
  <div id="buttons">
    <button class="btn reject" onclick="handleDecision(-1)">Pasando</button>
    <button class="btn accept" onclick="handleDecision(1)">Aquí sí</button>
  </div>
</div>

<!-- Resultados -->
<div id="results">
  <h2>Resultados</h2>
  <p id="player-info"></p>
  <div class="results-container">
    <div class="list">
      <h3>Aquí sí</h3>
      <ul id="accepted-list"></ul>
    </div>
    <div class="list">
      <h3>Pasando</h3>
      <ul id="rejected-list"></ul>
    </div>
  </div>
  <button class="btn stats-btn" onclick="showStats()">Ver estadísticas</button>
  <button class="btn reject" onclick="restartGame()">Volver al inicio</button>
</div>

<!-- Pantalla de estadísticas -->
<div id="stats-screen">
  <h2>Estadísticas globales</h2>
  <canvas id="statsChart" width="400" height="400"></canvas>
  <button class="btn reject" onclick="goToStart()">Volver</button>
</div>

<script>
  const saveEndpoint = "https://TU_PROYECTO.vercel.app/api/save";
  const dataUrl = "https://raw.githubusercontent.com/TU_USUARIO/TU_REPO/main/results/data.json";

  let playerName = "";
  const originalData = [
    { name: "Disney Tokyo", img: "img/disney.jpg" },
    { name: "Gotokuji", img: "img/gotokuji.jpg" },
    { name: "Pokemon Cafe", img: "img/pokemon.jpg" },
    { name: "Shikisai no oka", img: "img/shikisai.jpg" },
    { name: "Shinkansen Hello Kitty", img: "img/hello-kitty.jpg" },
    { name: "Maid cafe", img: "img/maid.jpg" },
    { name: "Nabana no sato", img: "img/nabana.jpg" },
    { name: "Otaru", img: "img/otaru.jpg" },
    { name: "Nagano y monos de nieve", img: "img/nagano.jpg" },
    { name: "RJ Cafe Osaka", img: "img/rj-cafe.jpg" },
    { name: "Kumachan Onsen Tokyo", img: "img/kumachan.jpg" },
    { name: "Enoshima", img: "img/enoshima.jpg" },
    { name: "Ginzan Onsen", img: "img/ginzan.jpg" },
    { name: "Tarde de recreativas", img: "img/arcade.jpg" },
    { name: "Shibazakura park Hokkaido", img: "img/shibazakura.jpg" },
    { name: "Musical Tokyo Revengers", img: "img/tokyo-revengers.jpg" },
    { name: "Eventos Kisekoi/Sailor Moon", img: "img/kisekoi.jpg" },
    { name: "Museo/cafe de los yokai", img: "img/yokai.jpg" },
    { name: "Kumamoto", img: "img/kumamoto.jpg" },
    { name: "Beppu", img: "img/beppu.jpg" },
    { name: "Bandai Museum", img: "img/bandai.jpg" }
  ];
  let data = [];
  let accepted = [];
  let rejected = [];
  let index = 0;
  const container = document.getElementById('card-container');

  function shuffleArray(array) { return array.sort(() => Math.random() - 0.5); }

  function startGame() {
    const nameInput = document.getElementById("username").value.trim();
    if (!nameInput) { alert("Que me digas quién eres o no jugamos ù3ú"); return; }
    playerName = nameInput;
    data = shuffleArray([...originalData]);
    document.getElementById("start-screen").style.display = "none";
    document.getElementById("game-screen").style.display = "flex";
    index = 0; accepted = []; rejected = []; container.innerHTML = "";
    showNextCard();
  }

  function createCard(person) {
    const card = document.createElement('div'); card.className = 'card';
    const img = document.createElement('img'); img.src = person.img; img.alt = person.name;
    const name = document.createElement('div'); name.textContent = person.name;
    card.appendChild(img); card.appendChild(name); container.appendChild(card);
  }

  function swipeCard(direction) {
    const currentCard = container.querySelector('.card:last-child');
    if (!currentCard) return;
    const name = currentCard.querySelector('div').textContent;
    if (direction === 1) { accepted.push(name); } else { rejected.push(name); }
    currentCard.remove(); showNextCard();
  }

  function handleDecision(direction) { swipeCard(direction); }

  function showNextCard() {
    if (index < data.length) { createCard(data[index]); index++; }
    else { showResults(); }
  }

  async function showResults() {
    document.getElementById('game-screen').style.display = 'none';
    document.getElementById('results').style.display = 'flex';
    const now = new Date(); const dateTime = now.toLocaleString();
    document.getElementById('player-info').textContent = `Jugador: ${playerName} | ${dateTime}`;
    const acceptedList = document.getElementById('accepted-list'); const rejectedList = document.getElementById('rejected-list');
    acceptedList.innerHTML = ""; rejectedList.innerHTML = "";
    accepted.forEach(n => { const li = document.createElement('li'); li.textContent = n; acceptedList.appendChild(li); });
    rejected.forEach(n => { const li = document.createElement('li'); li.textContent = n; rejectedList.appendChild(li); });

    await fetch(saveEndpoint, {
      method: "POST", headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ player: playerName, date: dateTime, accepted, rejected })
    });
  }

  async function showStats() {
    document.getElementById('start-screen').style.display = 'none';
    document.getElementById('results').style.display = 'none';
    document.getElementById('stats-screen').style.display = 'flex';
    const res = await fetch(dataUrl);
    const games = await res.json();
    const stats = {};
    games.forEach(g => {
      g.accepted.forEach(a => { stats[a] = stats[a] || { yes: 0, no: 0 }; stats[a].yes++; });
      g.rejected.forEach(r => { stats[r] = stats[r] || { yes: 0, no: 0 }; stats[r].no++; });
    });
    const labels = Object.keys(stats);
    const yesData = labels.map(l => stats[l].yes);
    const noData = labels.map(l => stats[l].no);

    new Chart(document.getElementById('statsChart'), {
      type: 'bar',
      data: {
        labels,
        datasets: [
          { label: 'Aquí sí', data: yesData, backgroundColor: '#87cefa' },
          { label: 'Pasando', data: noData, backgroundColor: '#ffc0cb' }
        ]
      },
      options: { responsive: true, scales: { x: { stacked: true }, y: { stacked: true } } }
    });
  }

  function restartGame() { document.getElementById("results").style.display = "none"; document.getElementById("start-screen").style.display = "flex"; }
  function goToStart() { document.getElementById("stats-screen").style.display = "none"; document.getElementById("start-screen").style.display = "flex"; }
</script>
</body>
</html>

