<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Japontinder</title>
<style>
  /* Paleta de colores */
  :root {
    --sakura-light:#fff7fb; --sakura-mid:#ffe3ef; --sakura-dark:#d38cb1; --sakura-a1:#d7a6f1; --sakura-a2:#b48ad6;
    --sky-light:#f2f9ff; --sky-mid:#e0f1ff; --sky-dark:#8dbfe6; --sky-a1:#a3c9ff; --sky-a2:#7fb2f0;
    --lav-light:#faf5ff; --lav-mid:#efe3ff; --lav-dark:#b48ad6; --lav-a1:#d7a6f1; --lav-a2:#b48ad6;
    --sun-light:#fff9e0; --sun-mid:#ffefb0; --sun-dark:#e0c050; --sun-a1:#f0d46a; --sun-a2:#e1b84f;
    --mint-light:#edfff7; --mint-mid:#d8ffee; --mint-dark:#68cba7; --mint-a1:#9fe6cc; --mint-a2:#68cba7;

    --btn-accept:#87cefa; --btn-reject:#ffc0cb; --btn-me:#dda0dd; --btn-stats:#dda0dd;
  }

  body{margin:0;font-family:'Yuji Syuku', serif;background:var(--sakura-light);display:flex;flex-direction:column;align-items:center;justify-content:center;}
  .hidden{display:none;}

  /* Pantalla de inicio */
  #start-screen{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;gap:20px;padding:20px;}
  #start-screen input{padding:10px;font-size:1rem;border-radius:8px;border:1px solid #ccc;}
  #start-screen button{padding:10px 20px;font-size:1rem;border:none;border-radius:8px;cursor:pointer;background:var(--btn-accept);color:#fff;}

  /* Pantalla de selección de modo */
  .mode-split{position:relative;width:100vw;height:100vh;display:grid;grid-template-columns:1fr 1fr;}
  .mode-half{display:flex;align-items:center;justify-content:center;flex-direction:column;gap:12px;cursor:pointer;padding:20px;transition:transform .15s ease;}
  .mode-half:hover{transform:scale(1.015);}
  .mode-title{font-size:clamp(26px,4vw,40px);font-weight:800;text-align:center;color:#fff;text-shadow:0 2px 8px rgba(0,0,0,.2);}
  .mode-desc{font-size:clamp(14px,2vw,18px);opacity:.95;text-align:center;max-width:580px;color:#fff;}
  .mode-half.short{background:var(--sun-mid);}
  .mode-half.full{background:var(--sky-mid);}

  /* Pantalla de juego */
  #game-screen{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;width:100vw;position:relative;}
  #card-container{display:flex;flex-direction:column;align-items:center;justify-content:center;width:90%;height:70%;background:#fff;border-radius:16px;box-shadow:0 4px 12px rgba(0,0,0,.2);}
  #card-container img{max-width:100%;max-height:100%;border-radius:12px;}
  #card-container h2{margin:10px 0;}
  .btn-row{display:flex;gap:12px;margin-top:20px;}
  .btn{padding:10px 16px;border:none;border-radius:12px;font-weight:700;cursor:pointer;}
  #accept-btn{background:var(--btn-accept);}
  #reject-btn{background:var(--btn-reject);}
  #me-btn{background:var(--btn-me);}

  /* Resultados */
  #result-screen{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;width:100vw;gap:16px;padding:20px;}
  #result-screen h2{margin:0;}
  #result-screen button{padding:10px 20px;border:none;border-radius:8px;background:var(--btn-stats);color:#fff;font-weight:700;cursor:pointer;}

  /* Estadísticas */
  #stats-screen{display:flex;flex-direction:column;align-items:center;justify-content:flex-start;height:100vh;width:100vw;overflow-y:auto;padding:20px;}
  #stats-screen table{border-collapse:collapse;width:90%;max-width:800px;}
  #stats-screen th, #stats-screen td{border:1px solid #ccc;padding:8px;text-align:center;}
  #stats-screen th{background:#eee;font-weight:700;}
</style>
</head>
<body>

<!-- Pantalla de inicio -->
<div id="start-screen">
  <h1>Bienvenido a Japontinder</h1>
  <p>Introduce tu nombre:</p>
  <input type="text" id="player-name" placeholder="Nombre">
  <button id="start-btn">Empezar</button>
  <p>Tutorial: Puedes seleccionar tarjetas con los botones o haciendo swipe. Swipe a la derecha: aceptar, izquierda: rechazar, arriba: "Me da igual".</p>
  <button id="view-stats-btn">Ver estadísticas</button>
</div>

<!-- Selección de modo -->
<div id="mode-screen" class="hidden">
  <div class="mode-split">
    <div class="mode-half short" data-mode="short">
      <h2 class="mode-title">Modo Corto</h2>
      <p class="mode-desc">20 tarjetas, solo 5 "Me da igual".</p>
    </div>
    <div class="mode-half full" data-mode="full">
      <h2 class="mode-title">Modo Completo</h2>
      <p class="mode-desc">Todas las tarjetas, solo 10 "Me da igual".</p>
    </div>
  </div>
</div>

<!-- Pantalla de juego -->
<div id="game-screen" class="hidden">
  <div id="card-container">
    <img id="card-img" src="" alt="">
    <h2 id="card-name"></h2>
  </div>
  <div class="btn-row">
    <button id="accept-btn" class="btn">Sí</button>
    <button id="me-btn" class="btn">Me da igual</button>
    <button id="reject-btn" class="btn">No</button>
  </div>
</div>

<!-- Pantalla de resultados -->
<div id="result-screen" class="hidden">
  <h2>Resultados</h2>
  <button id="stats-btn-result">Ver estadísticas</button>
</div>

<!-- Pantalla de estadísticas -->
<div id="stats-screen" class="hidden">
  <h2>Estadísticas Globales</h2>
  <table id="stats-table">
    <thead>
      <tr>
        <th>Jugador</th>
        <th>Tarjeta</th>
        <th>Elección</th>
        <th>Fecha</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button id="back-from-stats">Volver</button>
</div>

<script>
const BASE_CARDS = [
  { name: "Disney Tokyo", img: "img/disney.jpg" },
  { name: "Gotokuji", img: "img/gotokuji.jpg" },
  { name: "Pokemon Cafe", img: "img/pokemon.jpg" },
  { name: "Shikisai no oka", img: "img/shikisai.jpg" },
  { name: "Shinkansen Hello Kitty", img: "img/hello-kitty.jpg" },
  { name: "Maid cafe", img: "img/maid.jpg" },
  { name: "Nabana no sato", img: "img/nabana.jpg" },
  { name: "Otaru", img: "img/otaru.jpg" },
  { name: "Nagano y monos de nieve", img: "img/nagano.jpg" },
  { name: "RJ Cafe Osaka", img: "img/rj-cafe.jpg" },
  { name: "Kumachan Onsen Tokyo", img: "img/kumachan.jpg" },
  { name: "Enoshima", img: "img/enoshima.jpg" },
  { name: "Ginzan Onsen", img: "img/ginzan.jpg" },
  { name: "Tarde de recreativas", img: "img/arcade.jpg" },
  { name: "Shibazakura park Hokkaido", img: "img/shibazakura.jpg" },
  { name: "Musical Tokyo Revengers", img: "img/tokyo-revengers.jpg" },
  { name: "Eventos Kisekoi/Sailor Moon", img: "img/kisekoi.jpg" },
  { name: "Museo/cafe de los yokai", img: "img/yokai.jpg" },
  { name: "Kumamoto", img: "img/kumamoto.jpg" },
  { name: "Beppu", img: "img/beppu.jpg" },
  { name: "Bandai Museum", img: "img/bandai.jpg" }
];

const PLAYER_COLORS = {
  "Vaini": "#b48ad6",
  "Alicia": "#d68ad3",
  "Sara": "#ffc0cb",
  "Alba": "#87cefa"
};

let playerName = '';
let currentCards = [];
let currentIndex = 0;
let meCount = 0;
let meLimit = 0;

const startScreen = document.getElementById('start-screen');
const modeScreen = document.getElementById('mode-screen');
const gameScreen = document.getElementById('game-screen');
const resultScreen = document.getElementById('result-screen');
const statsScreen = document.getElementById('stats-screen');
const cardImg = document.getElementById('card-img');
const cardName = document.getElementById('card-name');

document.getElementById('start-btn').addEventListener('click', ()=>{
  const input = document.getElementById('player-name').value.trim();
  if(!input) return alert("Introduce tu nombre");
  playerName = input;
  startScreen.classList.add('hidden');
  modeScreen.classList.remove('hidden');
});

document.querySelectorAll('.mode-half').forEach(div=>{
  div.addEventListener('click', ()=>{
    startGame(div.dataset.mode);
  });
});

document.getElementById('accept-btn').addEventListener('click', ()=>choose('Sí'));
document.getElementById('reject-btn').addEventListener('click', ()=>choose('No'));
document.getElementById('me-btn').addEventListener('click', ()=>choose('Me da igual'));

document.getElementById('view-stats-btn').addEventListener('click', ()=>{startScreen.classList.add('hidden'); statsScreen.classList.remove('hidden'); loadStats();});
document.getElementById('stats-btn-result').addEventListener('click', ()=>{resultScreen.classList.add('hidden'); statsScreen.classList.remove('hidden'); loadStats();});
document.getElementById('back-from-stats').addEventListener('click', ()=>{statsScreen.classList.add('hidden'); startScreen.classList.remove('hidden');});

function shuffle(array){return array.sort(()=>Math.random()-0.5);}

function startGame(mode){
  modeScreen.classList.add('hidden');
  gameScreen.classList.remove('hidden');
  currentIndex = 0;
  meCount = 0;
  meLimit = (mode==='short')?5:10;
  currentCards = shuffle([...BASE_CARDS]);
  if(mode==='short') currentCards = currentCards.slice(0,20);
  document.getElementById('me-btn').style.background = PLAYER_COLORS[playerName] || 'var(--btn-me)';
  showCard();
}

function showCard(){
  if(currentIndex>=currentCards.length){
    gameScreen.classList.add('hidden');
    resultScreen.classList.remove('hidden');
    saveResult();
    return;
  }
  const card = currentCards[currentIndex];
  cardImg.src = card.img;
  cardName.textContent = card.name;
}

function choose(choice){
  if(choice==='Me da igual' && meCount>=meLimit) return alert(`Solo puedes usar "Me da igual" ${meLimit} veces`);
  if(choice==='Me da igual') meCount++;
  // Guardamos elección en data.json vía API o lógica backend (aquí simplificado)
  // Aquí se puede llamar a save.js en Vercel
  currentIndex++;
  showCard();
}

async function loadStats(){
  const tbody = document.querySelector('#stats-table tbody');
  tbody.innerHTML='';
  try{
    const res = await fetch('results/data.json');
    const data = await res.json();
    data.forEach(entry=>{
      const tr = document.createElement('tr');
      tr.style.backgroundColor = PLAYER_COLORS[entry.player] || 'inherit';
      tr.innerHTML = `<td>${entry.player}</td><td>${entry.card}</td><td>${entry.choice}</td><td>${entry.date}</td>`;
      tbody.appendChild(tr);
    });
  }catch(e){console.error(e);}
}

function saveResult(){
  // Aquí se llama a Vercel API para guardar partida actual
  // Ejemplo: fetch('/api/save', {method:'POST', body: JSON.stringify({player:playerName, results:currentCards})})
}
</script>
</body>
</html>
