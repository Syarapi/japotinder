<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Japotinder2</title>
<style>
:root {
  --sakura-light:#fff7fb; --sakura-mid:#ffe3ef; --sakura-dark:#d38cb1;
  --sky-light:#f2f9ff; --sky-mid:#e0f1ff; --sky-dark:#8dbfe6;
  --lav-light:#faf5ff; --lav-mid:#efe3ff; --lav-dark:#b48ad6;
  --sun-light:#fff9e0; --sun-mid:#ffefb0; --sun-dark:#e0c050;
  --mint-light:#edfff7; --mint-mid:#d8ffee; --mint-dark:#68cba7;

  --btn-accept:#87cefa; --btn-reject:#ffc0cb; --btn-me:#dda0dd; --btn-stats:#dda0dd;
}

/* General */
body{margin:0;font-family:'Yuji Syuku', serif;background:var(--sakura-light);display:flex;flex-direction:column;align-items:center;justify-content:center;}
.hidden{display:none;}

/* Inicio */
#start-screen{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;gap:20px;padding:20px;}
#start-screen input{padding:10px;font-size:1rem;border-radius:8px;border:1px solid #ccc;}
#start-screen button{padding:10px 20px;font-size:1rem;border:none;border-radius:8px;cursor:pointer;background:var(--btn-accept);color:#fff;}

/* Elección de modo vertical */
#mode-screen{display:flex;width:100vw;height:100vh;}
.mode-half{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;padding:20px;transition:transform .15s ease;}
.mode-half:hover{transform:scale(1.02);}
.mode-half h2{font-size:clamp(26px,4vw,40px);font-weight:800;text-align:center;color:#fff;text-shadow:0 2px 8px rgba(0,0,0,.2);}
.mode-half p{font-size:clamp(14px,2vw,18px);text-align:center;max-width:90%;color:#fff;}
.mode-short{background:var(--sun-mid);}
.mode-full{background:var(--sky-mid);}

/* Juego */
#game-screen{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;width:100vw;position:relative;touch-action: none;}
#card-container{display:flex;flex-direction:column;align-items:center;justify-content:center;width:90%;height:70%;background:#fff;border-radius:16px;box-shadow:0 4px 12px rgba(0,0,0,.2);}
#card-container img{max-width:100%;max-height:100%;border-radius:12px;}
#card-container h2{margin:10px 0;}
.btn-row{display:flex;gap:12px;margin-top:20px;}
.btn{padding:10px 16px;border:none;border-radius:12px;font-weight:700;cursor:pointer;}
#accept-btn{background:var(--btn-accept);}
#reject-btn{background:var(--btn-reject);}
#me-btn{background:var(--btn-me);}

/* Resultados */
#result-screen{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;width:100vw;gap:16px;padding:20px;}
#result-screen h2{margin:0;}
#result-screen button{padding:10px 20px;border:none;border-radius:8px;background:var(--btn-stats);color:#fff;font-weight:700;cursor:pointer;}

/* Estadísticas: dos tablas en fila */
#stats-screen{display:flex;flex-direction:row;align-items:flex-start;justify-content:center;height:100vh;width:100vw;overflow-x:auto;padding:20px;gap:20px;}
.stats-table-container{flex:1;overflow:auto;}
#stats-screen table{border-collapse:collapse;width:100%;max-width:600px;}
#stats-screen th, #stats-screen td{border:1px solid #ccc;padding:4px;text-align:center;}
#stats-screen th{background:#eee;font-weight:700;}
#stats-screen td.card-name{font-size:0.8rem;}
#stats-screen tbody tr:hover{background:rgba(0,0,0,0.05);}
#back-from-stats{padding:10px 20px;border:none;border-radius:8px;background:var(--btn-stats);color:#fff;font-weight:700;cursor:pointer;margin-top:10px;}

</style>
</head>
<body>

<!-- Pantalla de inicio -->
<div id="start-screen">
  <h1>Bienvenido a Japotinder2</h1>
  <p>Introduce tu nombre:</p>
  <input type="text" id="player-name" placeholder="Nombre">
  <button id="start-btn">Empezar</button>
  <p>Tutorial: Selecciona tarjetas con los botones o haciendo swipe. Derecha: Sí, izquierda: No, arriba: Me da igual.</p>
  <button id="view-stats-btn">Ver estadísticas</button>
</div>

<!-- Selección de modo -->
<div id="mode-screen" class="hidden">
  <div class="mode-half mode-short" data-mode="short">
    <h2>Modo Corto</h2>
    <p>20 tarjetas, solo 5 "Me da igual"</p>
  </div>
  <div class="mode-half mode-full" data-mode="full">
    <h2>Modo Completo</h2>
    <p>Todas las tarjetas, solo 10 "Me da igual"</p>
  </div>
</div>

<!-- Pantalla de juego -->
<div id="game-screen" class="hidden">
  <div id="card-container">
    <img id="card-img" src="" alt="">
    <h2 id="card-name"></h2>
  </div>
  <div class="btn-row">
    <button id="accept-btn" class="btn">Sí</button>
    <button id="me-btn" class="btn">Me da igual</button>
    <button id="reject-btn" class="btn">No</button>
  </div>
</div>

<!-- Resultados -->
<div id="result-screen" class="hidden">
  <h2>Resultados</h2>
  <button id="stats-btn-result">Ver estadísticas</button>
</div>

<!-- Estadísticas -->
<div id="stats-screen" class="hidden">
  <div class="stats-table-container">
    <h2>Estadísticas Globales</h2>
    <table id="stats-table">
      <thead>
        <tr>
          <th>Jugador</th>
          <th>Tarjeta</th>
          <th>Elección</th>
          <th>Fecha</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <div class="stats-table-container">
    <h2>Comparativa de Afinidad</h2>
    <table id="affinity-table">
      <thead>
        <tr><th>Jugador 1</th><th>Jugador 2</th><th>Tarjetas coincidencia</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <button id="back-from-stats">Volver</button>
</div>

<script>
const BASE_CARDS = [
  { name: "Disney Tokyo", img: "img/disney.jpg" },
  { name: "Gotokuji", img: "img/gotokuji.jpg" },
  { name: "Pokemon Cafe", img: "img/pokemon.jpg" },
  { name: "Shikisai no oka", img: "img/shikisai.jpg" },
  { name: "Shinkansen Hello Kitty", img: "img/hello-kitty.jpg" },
  { name: "Maid cafe", img: "img/maid.jpg" },
  { name: "Nabana no sato", img: "img/nabana.jpg" },
  { name: "Otaru", img: "img/otaru.jpg" },
  { name: "Nagano y monos de nieve", img: "img/nagano.jpg" },
  { name: "RJ Cafe Osaka", img: "img/rj-cafe.jpg" },
  { name: "Kumachan Onsen Tokyo", img: "img/kumachan.jpg" },
  { name: "Enoshima", img: "img/enoshima.jpg" },
  { name: "Ginzan Onsen", img: "img/ginzan.jpg" },
  { name: "Tarde de recreativas", img: "img/arcade.jpg" },
  { name: "Shibazakura park Hokkaido", img: "img/shibazakura.jpg" },
  { name: "Musical Tokyo Revengers", img: "img/tokyo-revengers.jpg" },
  { name: "Eventos Kisekoi/Sailor Moon", img: "img/kisekoi.jpg" },
  { name: "Museo/cafe de los yokai", img: "img/yokai.jpg" },
  { name: "Kumamoto", img: "img/kumamoto.jpg" },
  { name: "Beppu", img: "img/beppu.jpg" },
  { name: "Bandai Museum", img: "img/bandai.jpg" }
];

let playerName = "";
let gameMode = "";
let currentCards = [];
let currentIndex = 0;
let meCounter = 0;
const playerColors = {};
const specialColors = {Sara:'#ffc0cb',Alba:'#87cefa',Alicia:'#D68AD3',Vaini:'#a08ad6'};

// Funciones
function showScreen(id){
  document.querySelectorAll('body > div').forEach(d=>d.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}

// Inicio
document.getElementById('start-btn').addEventListener('click',()=>{
  const input=document.getElementById('player-name').value.trim();
  if(!input){alert('Introduce tu nombre');return;}
  playerName=input;
  showScreen('mode-screen');
});

document.querySelectorAll('.mode-half').forEach(div=>{
  div.addEventListener('click',()=>{
    gameMode=div.dataset.mode;
    startGame();
  });
});

function startGame(){
  showScreen('game-screen');
  currentCards = [...BASE_CARDS];
  if(gameMode==='short') currentCards = currentCards.slice(0,20);
  currentIndex=0;
  meCounter=0;
  shuffle(currentCards);
  showCard();
}

function shuffle(array){for(let i=array.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[array[i],array[j]]=[array[j],array[i]];}}

function showCard(){
  if(currentIndex>=currentCards.length){showResults();return;}
  const card=currentCards[currentIndex];
  document.getElementById('card-img').src=card.img;
  document.getElementById('card-name').textContent=card.name;
  card.choice='';
}

function choose(choice){
  if(choice==='me'){
    const limit = gameMode==='short'?5:10;
    if(meCounter>=limit){alert('"Me da igual" agotado');return;}
    meCounter++;
  }
  currentCards[currentIndex].choice=choice;
  currentIndex++;
  showCard();
}

// Botones
document.getElementById('accept-btn').addEventListener('click',()=>choose('yes'));
document.getElementById('reject-btn').addEventListener('click',()=>choose('no'));
document.getElementById('me-btn').addEventListener('click',()=>choose('me'));

// Swipe
let startX, startY;
const cardContainer=document.getElementById('card-container');
cardContainer.addEventListener('touchstart',e=>{startX=e.touches[0].clientX; startY=e.touches[0].clientY;});
cardContainer.addEventListener('touchend',e=>{
  const dx=e.changedTouches[0].clientX-startX;
  const dy=e.changedTouches[0].clientY-startY;
  if(Math.abs(dx)>50){choose(dx>0?'yes':'no');}
  else if(dy<-50){choose('me');}
});

// Resultados
function showResults(){
  showScreen('result-screen');
}

// Estadísticas
async function showStats(){
  showScreen('stats-screen');
  const res=await fetch('results/data.json');
  const data=await res.json();
  const tbody=document.querySelector('#stats-table tbody');
  tbody.innerHTML='';
  data.forEach(entry=>{
    if(!playerColors[entry.player]){
      playerColors[entry.player]=specialColors[entry.player]||randomColor();
    }
    const tr=document.createElement('tr');
    const tdName=document.createElement('td'); tdName.textContent=entry.player; tdName.style.color=playerColors[entry.player];
    const tdCard=document.createElement('td'); tdCard.textContent=entry.card; tdCard.className='card-name';
    const tdChoice=document.createElement('td'); tdChoice.textContent=entry.choice;
    const tdDate=document.createElement('td'); tdDate.textContent=entry.date;
    tr.append(tdName,tdCard,tdChoice,tdDate);
    tbody.appendChild(tr);
  });

  // Comparativa
  const affinityTbody=document.querySelector('#affinity-table tbody');
  affinityTbody.innerHTML='';
  const players=[...new Set(data.map(d=>d.player))];
  for(let i=0;i<players.length;i++){
    for(let j=i+1;j<players.length;j++){
      const p1=players[i]; const p2=players[j];
      const cards1=data.filter(d=>d.player===p1&&d.choice==='yes').map(d=>d.card);
      const cards2=data.filter(d=>d.player===p2&&d.choice==='yes').map(d=>d.card);
      const matches=cards1.filter(c=>cards2.includes(c)).length;
      const tr=document.createElement('tr');
      const td1=document.createElement('td'); td1.textContent=p1; td1.style.color=playerColors[p1];
      const td2=document.createElement('td'); td2.textContent=p2; td2.style.color=playerColors[p2];
      const tdM=document.createElement('td'); tdM.textContent=matches;
      tr.append(td1,td2,tdM);
      affinityTbody.appendChild(tr);
    }
  }
}

document.getElementById('view-stats-btn').addEventListener('click',showStats);
document.getElementById('stats-btn-result').addEventListener('click',showStats);
document.getElementById('back-from-stats').addEventListener('click',()=>showScreen('start-screen'));

function randomColor(){
  return '#' + Math.floor(Math.random()*16777215).toString(16);
}
</script>

</body>
</html>
